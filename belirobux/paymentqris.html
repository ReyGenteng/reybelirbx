<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RobuxNow.xyz - Jual Robux Terpercaya</title>
<meta name="keywords" content="beli robux, robux murah, jual robux, robux terpercaya, roblox, top up robux, robux aman, robux instant, robux preorder, robuxnow, robux now, robux ku, robux sekarang">
<meta name="description" content="RobuxNow.xyz adalah situs terpercaya untuk membeli Robux dengan harga termurah dan proses tercepat. Kami menyediakan berbagai metode top up Robux yang aman dan resmi. Kunjungi kami untuk pengalaman jual beli Robux yang terjamin asli dan aman.">
<link rel="icon" type="image/x-icon" href="https://reygenteng.github.io/reybelirbx/favicon.ico">
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: #fff;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
    }
    .container {
        max-width: 500px;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.8s ease-out;
    }
    h1 {
        font-size: 2.25rem;
        font-weight: 700;
        color: #ffd369;
        text-shadow: 0 0 10px rgba(255, 211, 105, 0.6);
        margin-bottom: 1rem;
    }
    .text-center { text-align: center; }
    input, button, select {
        width: 100%;
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 0.5rem;
    }
    input, select {
        background-color: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #fff;
        outline: none;
    }
    input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }
    input:focus, select:focus {
        border-color: #ffd369;
        box-shadow: 0 0 0 2px rgba(255, 211, 105, 0.3);
    }
    button {
        font-weight: bold;
        cursor: pointer;
        background: linear-gradient(135deg, #ffd369, #ffb74d);
        color: #222;
        border: none;
        position: relative;
        overflow: hidden;
    }
    button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 183, 77, 0.4);
    }
    button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }
    .button-cancel {
        background: linear-gradient(135deg, #8A2387, #E94057, #F27121);
        color: white;
    }
    .button-cancel:hover:not(:disabled) {
        box-shadow: 0 5px 15px rgba(233, 64, 87, 0.4);
    }
    .status-container {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        display: none;
    }
    #qrisImage {
        width: 100%;
        max-width: 250px;
        height: auto;
        border-radius: 0.75rem;
        margin: 0 auto 1rem;
        display: block;
    }
    .text-sm { font-size: 0.875rem; }
    #message-box {
        position: fixed;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: #fff;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
    }
    .loader {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
        vertical-align: middle;
    }
    .transaction-info {
        background-color: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
    }
    .transaction-info p {
        margin: 0.5rem 0;
        display: flex;
        justify-content: space-between;
    }
    .transaction-info span {
        font-weight: bold;
        color: #ffd369;
    }
    .countdown {
        font-size: 1.2rem;
        font-weight: bold;
        text-align: center;
        margin: 1rem 0;
        color: #ff6b6b;
    }
    .payment-status {
        padding: 0.5rem;
        border-radius: 0.5rem;
        text-align: center;
        margin-bottom: 1rem;
        font-weight: bold;
    }
    .status-pending {
        background-color: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }
    .status-paid {
        background-color: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
    .status-expired {
        background-color: rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }
    .status-cancel {
        background-color: rgba(108, 117, 125, 0.2);
        color: #6c757d;
    }
    .input-group {
        margin-bottom: 1rem;
    }
    .input-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
    }
    .button-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    .button-group button {
        flex: 1;
    }
    .expiry-info {
        text-align: center;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.7);
    }
    @keyframes fadeIn { 
        from { opacity: 0; transform: scale(0.95); } 
        to { opacity: 1; transform: scale(1); } 
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    @media (max-width: 640px) {
        .container {
            padding: 1.5rem;
        }
        h1 {
            font-size: 1.75rem;
        }
        .button-group {
            flex-direction: column;
        }
    }
</style>
</head>
<body>

<div class="container">
    <div class="text-center">
        <h1>RobuxNow.xyz</h1>
        <p class="text-white/80">Pembayaran Cepat dengan AtlanticH2H</p>
    </div>
    <div class="input-group">
        <label for="nominalInput" class="input-label">Nominal Deposit (IDR)</label>
        <input type="number" id="nominalInput" placeholder="Masukkan nominal (cth: 5000)" min="1" step="1000">
    </div>
    <button id="createDepositBtn" class="mt-4">
        <span id="createText">Buat Pembayaran</span>
        <span id="createLoading" class="loader" style="display: none;"></span>
    </button>
    <p class="expiry-info">Lakukan pembayaran dalam <span id="expiryTimeInfo">batas waktu API</span></p>
    <div id="statusContainer" class="status-container">
        <h2 class="text-lg font-bold text-center mb-4 text-white">Status Pembayaran</h2>
        <div id="paymentStatus" class="payment-status status-pending">Menunggu Pembayaran</div>
        <div id="countdown" class="countdown">00m 00s</div>
        <div id="qrCodeDisplay" class="text-center mb-4"></div>
        <div id="transactionInfo" class="transaction-info">
            <p>Nominal: <span id="infoNominal"></span></p>
            <p>Biaya Admin: <span id="infoBiayaAdmin">Memeriksa...</span></p>
        </div>
        <p class="text-center text-sm mb-2 text-white/80">ID Transaksi (Reff ID):</p>
        <p id="transactionId" class="text-center text-lg font-bold mb-4 text-yellow-300"></p>
        <div class="button-group">
            <button id="checkStatusBtn">
                <span id="checkText">Cek Status</span>
                <span id="checkLoading" class="loader" style="display: none;"></span>
            </button>
            <button id="cancelBtn" class="button-cancel">
                <span id="cancelText">Batalkan</span>
                <span id="cancelLoading" class="loader" style="display: none;"></span>
            </button>
        </div>
    </div>
</div>
<div id="message-box"></div>

<script>
    // üîë KUNCI API RAHASIA (Ganti dengan API KEY kamu)
    const API_KEY = 'FTW3QIWAUHpNj8JFlswhQms20APM1CwcxQZchHiREFyRiMcSpMsmrli4QSlsbf3ZcjOXxiUWQjU6t2ugFLaT7DazgIhstAycbteN'; // üëà GANTI INI
    
    // üåê URL API AtlanticH2H
    //
    // ‚ö†Ô∏è PERUBAHAN PENTING ADA DI SINI ‚ö†Ô∏è
    // Ganti URL ini dengan URL Cloudflare Worker kamu yang tadi di-copy!
    //
    const BASE_URL = 'https://sparkling-bread-10a9.csrobuxnow-xyz.workers.dev/'; // üëà GANTI INI
    
    // -----------------------------------------------------------------
    
    const URL_API_CREATE = `${BASE_URL}/deposit/create`;
    const URL_API_STATUS = `${BASE_URL}/deposit/status`;
    const URL_API_CANCEL = `${BASE_URL}/deposit/cancel`;
    
    // Waktu polling status (misal: setiap 10 detik)
    const WAKTU_POLLING = 10000; 

    // Elemen DOM
    const inputNominal = document.getElementById('nominalInput');
    const tombolBuatDeposit = document.getElementById('createDepositBtn');
    const teksBuat = document.getElementById('createText');
    const loadingBuat = document.getElementById('createLoading');
    const kontainerStatus = document.getElementById('statusContainer');
    const tampilanKodeQR = document.getElementById('qrCodeDisplay');
    const tampilanIdTransaksi = document.getElementById('transactionId');
    const infoNominal = document.getElementById('infoNominal');
    const infoBiayaAdmin = document.getElementById('infoBiayaAdmin');
    const statusPembayaran = document.getElementById('paymentStatus');
    const hitungMundurEl = document.getElementById('countdown');
    const tombolCekStatus = document.getElementById('checkStatusBtn');
    const teksCek = document.getElementById('checkText');
    const loadingCek = document.getElementById('checkLoading');
    const tombolBatal = document.getElementById('cancelBtn');
    const teksBatal = document.getElementById('cancelText');
    const loadingBatal = document.getElementById('cancelLoading');
    const kotakPesan = document.getElementById('message-box');
    const infoWaktuKadaluarsa = document.getElementById('expiryTimeInfo');

    // Variabel global
    let atlanticID = null;
    let reffIdKita = null;
    let intervalPolling = null;
    let intervalHitungMundur = null;

    // --- (SEMUA FUNGSI JavaScript di bawah ini SAMA PERSIS, tidak ada perubahan) ---

    // Fungsi untuk menghasilkan Reff ID unik
    function buatReffIdUnik() {
        const timestamp = new Date().getTime();
        return 'T' + timestamp.toString(); 
    }

    // Fungsi untuk menampilkan pesan
    function tampilkanPesan(pesan, durasi = 3000, adalahError = false) {
        kotakPesan.textContent = pesan;
        kotakPesan.style.display = 'block';
        kotakPesan.style.background = adalahError ? '#dc2626' : '#16a34a';
        
        setTimeout(() => {
            kotakPesan.style.display = 'none';
        }, durasi);
    }

    // Fungsi untuk memformat mata uang Rupiah
    function formatRupiah(jumlah) {
        const num = parseFloat(jumlah);
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(num);
    }

    // Fungsi untuk mengatur status loading
    function aturLoading(tombol, elemenTeks, elemenLoading, sedangLoading) {
        if (sedangLoading) {
            elemenTeks.style.display = 'none';
            elemenLoading.style.display = 'inline-block';
            tombol.disabled = true;
        } else {
            elemenTeks.style.display = 'inline';
            elemenLoading.style.display = 'none';
            tombol.disabled = false;
        }
    }
    
    // Fungsi untuk membersihkan status lama
    function bersihkanStatus() {
        clearInterval(intervalPolling);
        clearInterval(intervalHitungMundur);
        atlanticID = null;
        reffIdKita = null;
        tombolBatal.style.display = 'inline-block';
        loadingBatal.style.display = 'none';
        teksBatal.style.display = 'inline';
    }

    // Fungsi Hitung Mundur
    function mulaiHitungMundur(waktuKadaluarsa) {
        const targetWaktu = new Date(waktuKadaluarsa.replace(' ', 'T')).getTime();
        infoWaktuKadaluarsa.textContent = `sampai ${waktuKadaluarsa}`;
        clearInterval(intervalHitungMundur);

        intervalHitungMundur = setInterval(() => {
            const sekarang = new Date().getTime();
            const selisih = targetWaktu - sekarang;

            if (selisih <= 0) {
                clearInterval(intervalHitungMundur);
                hitungMundurEl.textContent = "Kadaluarsa!";
                statusPembayaran.textContent = "Kadaluarsa ‚è≥";
                statusPembayaran.className = "payment-status status-expired";
                tampilanKodeQR.innerHTML = '<p class="text-sm text-red-400">QR Code telah kadaluarsa. Silakan buat transaksi baru.</p>';
                tombolBatal.style.display = 'none';
            } else {
                const menit = Math.floor((selisih % (1000 * 60 * 60)) / (1000 * 60));
                const detik = Math.floor((selisih % (1000 * 60)) / 1000);
                const m = String(menit).padStart(2, '0');
                const s = String(detik).padStart(2, '0');
                hitungMundurEl.textContent = `${m}m ${s}s`;
            }
        }, 1000);
    }

    // Event listener untuk tombol Buat Pembayaran
    tombolBuatDeposit.addEventListener('click', async () => {
        const nominal = parseInt(inputNominal.value);

        if (isNaN(nominal) || nominal < 1) {
            tampilkanPesan('Nominal minimal Rp 1!', 3000, true);
            return;
        }

        bersihkanStatus();
        aturLoading(tombolBuatDeposit, teksBuat, loadingBuat, true);
        const reffIdBaru = buatReffIdUnik();
        reffIdKita = reffIdBaru;

        const bodyParams = new URLSearchParams();
        bodyParams.append('api_key', API_KEY);
        bodyParams.append('reff_id', reffIdBaru);
        bodyParams.append('nominal', nominal.toString());
        bodyParams.append('type', 'ewallet');
t        bodyParams.append('metode', 'qris');

        try {
            // Fetch sekarang memanggil URL_API_CREATE (Worker kamu)
            const response = await fetch(URL_API_CREATE, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: bodyParams 
            });

            const data = await response.json();
            console.log('Respon /deposit/create:', data); 

            if (data.status === true && data.data) {
                atlanticID = data.data.id; 
                tampilanIdTransaksi.textContent = data.data.reff_id;
                tampilanKodeQR.innerHTML = `
                    <p class="text-sm mb-2">Scan QR code berikut untuk melakukan pembayaran:</p>
                    <img id="qrisImage" src="${data.data.qr_image}" alt="QRIS Code">
                `;
                infoNominal.textContent = formatRupiah(data.data.nominal);
                infoBiayaAdmin.textContent = "Memeriksa...";
                statusPembayaran.textContent = "Menunggu Pembayaran";
                statusPembayaran.className = "payment-status status-pending";
                mulaiHitungMundur(data.data.expired_at);
                kontainerStatus.style.display = 'block';
                tampilkanPesan('Pembayaran berhasil dibuat! Silakan scan QR.');
                intervalPolling = setInterval(cekStatusPembayaran, WAKTU_POLLING);
            } else {
                throw new Error(data.message || 'Gagal membuat pembayaran.');
            }
        } catch (error) {
            console.error('Error:', error);
            tampilkanPesan(`Error: ${error.message}`, 5000, true);
        } finally {
            aturLoading(tombolBuatDeposit, teksBuat, loadingBuat, false);
        }
    });

    // Fungsi untuk memeriksa status pembayaran
    async function cekStatusPembayaran(manual = false) {
        if (!atlanticID) return;

        const bodyParams = new URLSearchParams();
        bodyParams.append('api_key', API_KEY);
        bodyParams.append('id', atlanticID);

        try {
            // Fetch sekarang memanggil URL_API_STATUS (Worker kamu)
            const response = await fetch(URL_API_STATUS, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: bodyParams
            });

            const data = await response.json();
            console.log('Respon /deposit/status:', data);

            if (data.status === true && data.data) {
                const statusAPI = data.data.status;
                if (data.data.fee) {
                    infoBiayaAdmin.textContent = formatRupiah(data.data.fee);
                }

                if (statusAPI === 'success') {
                    statusPembayaran.textContent = "Dibayar (LUNAS) üéâ";
                    statusPembayaran.className = "payment-status status-paid";
                    bersihkanStatus();
                    tampilkanPesan('Pembayaran berhasil! Saldo akan segera ditambahkan.', 5000);
                    tampilanKodeQR.innerHTML = '<p class="text-sm text-green-400">Pembayaran Lunas. Terima kasih!</p>';
                    tombolBatal.style.display = 'none';
                } else if (statusAPI === 'cancel') {
                    statusPembayaran.textContent = "Dibatalkan üö´";
                    statusPembayaran.className = "payment-status status-cancel";
                    bersihkanStatus();
                    tampilkanPesan('Transaksi ini telah dibatalkan.', 5000, true);
                    tampilanKodeQR.innerHTML = '<p class="text-sm text-gray-400">Transaksi dibatalkan. Silakan buat transaksi baru.</p>';
                    tombolBatal.style.display = 'none';
                } else if (statusAPI === 'pending') {
                    statusPembayaran.textContent = "Menunggu Pembayaran ‚è±Ô∏è";
                    statusPembayaran.className = "payment-status status-pending";
                    if (manual) tampilkanPesan('Status masih Menunggu Pembayaran.');
                } else if (statusAPI === 'expired') {
                     statusPembayaran.textContent = "Kadaluarsa ‚è≥";
                    statusPembayaran.className = "payment-status status-expired";
                    bersihkanStatus();
                    tampilanKodeQR.innerHTML = '<p class="text-sm text-red-400">Transaksi kadaluarsa. Silakan buat transaksi baru.</p>';
                    tombolBatal.style.display = 'none';
                }
            } else {
                 console.error('Gagal Cek Status:', data.message);
                 if (manual) tampilkanPesan(`Gagal cek status: ${data.message}`, 3000, true);
            }
        } catch (error) {
            console.error('Error memeriksa status:', error);
            if (manual) tampilkanPesan(`Error: ${error.message}`, 3000, true);
        }
    }

    // Event listener untuk tombol Cek Status (Manual)
    tombolCekStatus.addEventListener('click', async () => {
        if (!atlanticID) {
            tampilkanPesan('Tidak ada transaksi aktif', 3000, true);
            return;
        }
        aturLoading(tombolCekStatus, teksCek, loadingCek, true);
        await cekStatusPembayaran(true);
        aturLoading(tombolCekStatus, teksCek, loadingCek, false);
    });

    // Event listener untuk tombol Batalkan
    tombolBatal.addEventListener('click', async () => {
        if (!atlanticID) {
            tampilkanPesan('Tidak ada transaksi aktif', 3000, true);
            return;
        }
        if (!confirm('Apakah kamu yakin ingin membatalkan transaksi ini?')) {
            return;
        }
        aturLoading(tombolBatal, teksBatal, loadingBatal, true);

        const bodyParams = new URLSearchParams();
        bodyParams.append('api_key', API_KEY);
        bodyParams.append('id', atlanticID);

        try {
            // Fetch sekarang memanggil URL_API_CANCEL (Worker kamu)
            const response = await fetch(URL_API_CANCEL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: bodyParams
            });

            const data = await response.json();
            console.log('Respon /deposit/cancel:', data);

            if (data.status === true && data.data.status === 'cancel') {
                await cekStatusPembayaran(true); 
            } else {
                throw new Error(data.message || 'Gagal membatalkan transaksi.');
            }

        } catch (error) {
            console.error('Error membatalkan:', error);
            tampilkanPesan(`Error: ${error.message}`, 5000, true);
        } finally {
            aturLoading(tombolBatal, teksBatal, loadingBatal, false);
        }
    });

</script>
</body>
</html>
