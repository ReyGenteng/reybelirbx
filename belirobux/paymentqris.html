<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RobuxNow.xyz - Jual Robux Terpercaya</title>
<meta name="keywords" content="beli robux, robux murah, jual robux, robux terpercaya, roblox, top up robux, robux aman, robux instant, robux preorder, robuxnow, robux now, robux ku, robux sekarang">
<meta name="description" content="RobuxNow.xyz adalah situs terpercaya untuk membeli Robux dengan harga termurah dan proses tercepat. Kami menyediakan berbagai metode top up Robux yang aman dan resmi. Kunjungi kami untuk pengalaman jual beli Robux yang terjamin asli dan aman.">
<link rel="icon" type="image/x-icon" href="https://reygenteng.github.io/reybelirbx/favicon.ico">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/md5.min.js"></script>
<style>
    body {
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
        color: #fff;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1.5rem;
    }
    .container {
        max-width: 500px;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        animation: fadeIn 0.8s ease-out;
    }
    h1 {
        font-size: 2.25rem;
        font-weight: 700;
        color: #ffd369;
        text-shadow: 0 0 10px rgba(255, 211, 105, 0.6);
        margin-bottom: 1rem;
    }
    .text-center { text-align: center; }
    input, button, select {
        width: 100%;
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 0.5rem;
    }
    input, select {
        background-color: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: #fff;
        outline: none;
    }
    input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }
    input:focus, select:focus {
        border-color: #ffd369;
        box-shadow: 0 0 0 2px rgba(255, 211, 105, 0.3);
    }
    button {
        font-weight: bold;
        cursor: pointer;
        background: linear-gradient(135deg, #ffd369, #ffb74d);
        color: #222;
        border: none;
        position: relative;
        overflow: hidden;
    }
    button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 183, 77, 0.4);
    }
    button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }
    .status-container {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        display: none;
    }
    #qrisImage {
        width: 100%;
        max-width: 250px;
        height: auto;
        border-radius: 0.75rem;
        margin: 0 auto 1rem;
        display: block;
    }
    .text-sm { font-size: 0.875rem; }
    #message-box {
        position: fixed;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: #fff;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
    }
    .loader {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
        vertical-align: middle;
    }
    .transaction-info {
        background-color: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 0.75rem;
        margin-bottom: 1rem;
    }
    .transaction-info p {
        margin: 0.5rem 0;
        display: flex;
        justify-content: space-between;
    }
    .transaction-info span {
        font-weight: bold;
        color: #ffd369;
    }
    .countdown {
        font-size: 1.2rem;
        font-weight: bold;
        text-align: center;
        margin: 1rem 0;
        color: #ff6b6b;
    }
    .payment-status {
        padding: 0.5rem;
        border-radius: 0.5rem;
        text-align: center;
        margin-bottom: 1rem;
        font-weight: bold;
    }
    .status-pending {
        background-color: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }
    .status-paid {
        background-color: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
    .status-expired {
        background-color: rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }
    .input-group {
        margin-bottom: 1rem;
    }
    .input-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
    }
    .button-group {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    .button-group button {
        flex: 1;
    }
    .expiry-info {
        text-align: center;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: rgba(255, 255, 255, 0.7);
    }
    @keyframes fadeIn { 
        from { opacity: 0; transform: scale(0.95); } 
        to { opacity: 1; transform: scale(1); } 
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    @media (max-width: 640px) {
        .container {
            padding: 1.5rem;
        }
        h1 {
            font-size: 1.75rem;
        }
        .button-group {
            flex-direction: column;
        }
    }
</style>
</head>
<body>

<div class="container">
    <div class="text-center">
        <h1>RobuxNow.xyz</h1>
        <p class="text-white/80">Pembayaran Cepat dengan Topupku</p>
    </div>

    <div class="input-group">
        <label for="nominalInput" class="input-label">Nominal Deposit (IDR)</label>
        <input type="number" id="nominalInput" placeholder="Masukkan nominal (cth: 5000)" min="100" step="1000">
    </div>

    <div class="input-group">
        <label for="metodePembayaran" class="input-label">Pilih Metode Pembayaran (QRIS)</label>
        <select id="metodePembayaran">
            <option value="SP">QRIS (QRIS Standard)</option>
            <option value="NC">QRIS 2 (QRIS NeoBank)</option>
            </select>
    </div>

    <button id="createDepositBtn" class="mt-4">
        <span id="createText">Buat Pembayaran</span>
        <span id="createLoading" class="loader" style="display: none;"></span>
    </button>
    
    <p class="expiry-info">Lakukan pembayaran dalam <span id="expiryTimeInfo">batas waktu API</span></p>


    <div id="statusContainer" class="status-container">
        <h2 class="text-lg font-bold text-center mb-4 text-white">Status Pembayaran</h2>
        
        <div id="paymentStatus" class="payment-status status-pending">Menunggu Pembayaran</div>
        
        <div id="countdown" class="countdown"></div>
        
        <div id="qrCodeDisplay" class="text-center mb-4">
            </div>
        
        <div id="transactionInfo" class="transaction-info">
            <p>Kode Bank: <span id="infoKodeBank"></span></p>
            <p>Nominal: <span id="infoNominal"></span></p>
            <p>Biaya Admin: <span id="infoBiayaAdmin"></span></p>
            </div>
        
        <p class="text-center text-sm mb-2 text-white/80">ID Transaksi (Reff ID):</p>
        <p id="transactionId" class="text-center text-lg font-bold mb-4 text-yellow-300"></p>
        
        <div class="button-group">
            <button id="checkStatusBtn">
                <span id="checkText">Cek Status</span>
                <span id="checkLoading" class="loader" style="display: none;"></span>
            </button>
            </div>
    </div>

</div>

<div id="message-box"></div>

<script>
    // üîë KUNCI API RAHASIA (Gunakan API ID dan API KEY kamu)
    const API_ID = '27a78e4871ff';
    const API_KEY = 'a5dc714da36f41db2d3c9f0d3ac8a4c90fa6146e';
    
    // üåê URL API Topupku
    const URL_API_PEMBAYARAN = 'https://topupku.com/api/payment';
    const URL_API_STATUS = 'https://topupku.com/api/status-payment';
    
    // Waktu polling status (Topupku.com menyarankan 10-20 detik)
    const WAKTU_POLLING = 15000; 

    // Elemen DOM
    const inputNominal = document.getElementById('nominalInput');
    const pilihMetode = document.getElementById('metodePembayaran');
    const tombolBuatDeposit = document.getElementById('createDepositBtn');
    const teksBuat = document.getElementById('createText');
    const loadingBuat = document.getElementById('createLoading');
    const kontainerStatus = document.getElementById('statusContainer');
    const tampilanKodeQR = document.getElementById('qrCodeDisplay');
    const tampilanIdTransaksi = document.getElementById('transactionId');
    const infoNominal = document.getElementById('infoNominal');
    const infoBiayaAdmin = document.getElementById('infoBiayaAdmin');
    const infoKodeBank = document.getElementById('infoKodeBank');
    const statusPembayaran = document.getElementById('paymentStatus');
    const hitungMundurEl = document.getElementById('countdown');
    const tombolCekStatus = document.getElementById('checkStatusBtn');
    const teksCek = document.getElementById('checkText');
    const loadingCek = document.getElementById('checkLoading');
    const kotakPesan = document.getElementById('message-box');
    const infoWaktuKadaluarsa = document.getElementById('expiryTimeInfo');

    // Variabel global
    let idTransaksiSaatIni = null; // Ini akan menjadi reff_id
    let intervalPolling = null;
    let intervalHitungMundur = null;

    // --- FUNGSI UTAMA ---

    // Fungsi untuk membuat signature MD5
    function buatSignature(reffId) {
        // rumus: md5(api_id + api_key + reff_id)
        const stringToHash = API_ID + API_KEY + reffId;
        // PENTING: Pastikan md5.min.js sudah diload (lihat <head>)
        return CryptoJS.MD5(stringToHash).toString();
    }
    
    // Fungsi untuk menghasilkan Reff ID unik (misalnya: 'Robux' + timestamp)
    function buatReffIdUnik() {
        const timestamp = new Date().getTime();
        // Hanya angka yang diperbolehkan oleh Topupku, jadi pakai timestamp saja
        return 'T' + timestamp.toString(); 
    }

    // Fungsi untuk menampilkan pesan
    function tampilkanPesan(pesan, durasi = 3000, adalahError = false) {
        kotakPesan.textContent = pesan;
        kotakPesan.style.display = 'block';
        kotakPesan.style.background = adalahError ? '#dc2626' : '#16a34a';
        
        setTimeout(() => {
            kotakPesan.style.display = 'none';
        }, durasi);
    }

    // Fungsi untuk memformat mata uang Rupiah
    function formatRupiah(jumlah) {
        // Topupku nominalnya adalah KELIPATAN 100, tapi API kadang mereturn angka lengkap
        const num = parseFloat(jumlah);
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(num);
    }

    // Fungsi untuk mengatur status loading
    function aturLoading(tombol, elemenTeks, elemenLoading, sedangLoading) {
        if (sedangLoading) {
            elemenTeks.style.display = 'none';
            elemenLoading.style.display = 'inline-block';
            tombol.disabled = true;
        } else {
            elemenTeks.style.display = 'inline';
            elemenLoading.style.display = 'none';
            tombol.disabled = false;
        }
    }
    
    // Fungsi untuk menghapus QR (kalau kadaluarsa/batal)
    function hapusKodeQR() {
        tampilanKodeQR.innerHTML = '<p class="text-sm text-yellow-300">Harap buat transaksi baru.</p>';
    }

    // Event listener untuk tombol Buat Pembayaran
    tombolBuatDeposit.addEventListener('click', async () => {
        const nominal = parseInt(inputNominal.value);
        const kodeBank = pilihMetode.value;

        if (isNaN(nominal) || nominal < 100) { // Topupku nominal min Rp 100
            tampilkanPesan('Nominal minimal Rp 100!', 3000, true);
            return;
        }

        // Hentikan polling dan countdown lama jika ada
        clearInterval(intervalPolling);
        clearInterval(intervalHitungMundur);

        aturLoading(tombolBuatDeposit, teksBuat, loadingBuat, true);

        // Buat Reff ID baru
        const reffIdBaru = buatReffIdUnik();
        const signature = buatSignature(reffIdBaru);

        // Data yang akan dikirim ke API Topupku
        const bodyData = {
            api_id: API_ID,
            api_key: API_KEY,
            nominal: nominal.toString(),
            signature: signature,
            reff_id: reffIdBaru,
            kode_bank: kodeBank
        };

        try {
            const response = await fetch(URL_API_PEMBAYARAN, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(bodyData)
            });

            const data = await response.json();
            
            if (data.status === true && data.data && data.data.qr_image) {
                // Sukses membuat transaksi
                idTransaksiSaatIni = reffIdBaru;
                tampilanIdTransaksi.textContent = idTransaksiSaatIni;
                
                // Tampilkan QR Code dan Info Transaksi
                tampilanKodeQR.innerHTML = `
                    <p class="text-sm mb-2">Scan QR code berikut untuk melakukan pembayaran:</p>
                    <img id="qrisImage" src="${data.data.qr_image}" alt="QRIS Code">
                `;

                infoKodeBank.textContent = data.data.kode_bank_text;
                infoNominal.textContent = formatRupiah(data.data.nominal);
                infoBiayaAdmin.textContent = formatRupiah(data.data.fee);

                // Atur status pending awal
                statusPembayaran.textContent = "Menunggu Pembayaran";
                statusPembayaran.className = "payment-status status-pending";
                hitungMundurEl.textContent = `Kadaluarsa: ${data.data.expired_time}`;
                infoWaktuKadaluarsa.textContent = `sampai ${data.data.expired_time}`;
                
                kontainerStatus.style.display = 'block';
                tampilkanPesan('Pembayaran berhasil dibuat! Silakan scan QR.');

                // Mulai polling status
                intervalPolling = setInterval(cekStatusPembayaran, WAKTU_POLLING);
            } else {
                // Gagal, tampilkan pesan error dari API
                throw new Error(data.message || 'Gagal membuat pembayaran. Cek nominal/metode.');
            }
        } catch (error) {
            console.error('Error:', error);
            tampilkanPesan(`Error: ${error.message}`, 5000, true);
        } finally {
            aturLoading(tombolBuatDeposit, teksBuat, loadingBuat, false);
        }
    });

    // Fungsi untuk memeriksa status pembayaran
    async function cekStatusPembayaran() {
        if (!idTransaksiSaatIni) return;

        // Data yang akan dikirim ke API Status Topupku
        const bodyData = {
            api_id: API_ID,
            api_key: API_KEY,
            reff_id: idTransaksiSaatIni,
            signature: buatSignature(idTransaksiSaatIni)
        };

        try {
            const response = await fetch(URL_API_STATUS, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(bodyData)
            });

            const data = await response.json();
            
            if (data.status === true && data.data) {
                const statusAPI = data.data.status;
                
                // Status Topupku: PAID (Lunas), UNPAID (Belum Bayar), EXPIRED (Kadaluarsa)
                if (statusAPI === 'PAID') {
                    statusPembayaran.textContent = "Dibayar (LUNAS) üéâ";
                    statusPembayaran.className = "payment-status status-paid";
                    clearInterval(intervalPolling);
                    hitungMundurEl.textContent = "Pembayaran berhasil! Saldo sudah ditambahkan.";
                    tampilkanPesan('Pembayaran berhasil! Saldo akan segera ditambahkan.', 5000);
                    hapusKodeQR();
                } else if (statusAPI === 'EXPIRED') {
                    statusPembayaran.textContent = "Kadaluarsa ‚è≥";
                    statusPembayaran.className = "payment-status status-expired";
                    clearInterval(intervalPolling);
                    hitungMundurEl.textContent = "Waktu pembayaran telah habis!";
                    tampilkanPesan('Transaksi kadaluarsa. Silakan buat yang baru.', 5000, true);
                    hapusKodeQR();
                } else if (statusAPI === 'UNPAID') {
                    // Masih UNPAID (Lanjut polling)
                    statusPembayaran.textContent = "Menunggu Pembayaran ‚è±Ô∏è";
                    statusPembayaran.className = "payment-status status-pending";
                }
            } else {
                 // Gagal cek status (Mungkin koneksi/error API)
                 console.error('Gagal Cek Status:', data.message);
            }
        } catch (error) {
            console.error('Error memeriksa status:', error);
        }
    }

    // Event listener untuk tombol Cek Status (Manual)
    tombolCekStatus.addEventListener('click', async () => {
        if (!idTransaksiSaatIni) {
            tampilkanPesan('Tidak ada transaksi aktif', 3000, true);
            return;
        }
        aturLoading(tombolCekStatus, teksCek, loadingCek, true);
        await cekStatusPembayaran();
        aturLoading(tombolCekStatus, teksCek, loadingCek, false);
        tampilkanPesan('Status diperbarui! ‚úÖ');
    });

    // Inisialisasi halaman
    infoWaktuKadaluarsa.textContent = 'ditentukan oleh API';
</script>
</body>
</html>
