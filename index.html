<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beli Robux</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: white;
    min-height: 100vh;
    display: flex; justify-content: center; align-items: center;
  }
  .menu, .form-box {
    background: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    max-width: 400px; width: 100%;
    text-align: center;
  }
  h2 { margin-bottom: 20px; }
  button {
    width: 100%; padding: 12px; margin: 10px 0;
    font-size: 16px; font-weight: bold;
    border: none; border-radius: 8px; cursor: pointer;
    background: #0ea5e9; color: white;
  }
  button:hover { background: #0284c7; }
  input {
    width: 100%; padding: 10px; margin: 5px 0;
    border: none; border-radius: 8px;
    background: #334155; color: white; font-size: 16px;
  }
  label { display:block; margin-top:15px; text-align:left; }
  #searchResults {
    background: #1e293b;
    position: absolute;
    width: calc(100% - 40px);
    max-height: 200px; overflow-y: auto;
    border-radius: 8px;
    border: 1px solid #334155;
    display: none; z-index: 100;
  }
  .result-item {
    padding: 8px; cursor: pointer;
    display: flex; align-items: center; gap: 10px;
  }
  .result-item:hover { background: #334155; }
  .result-item img { width: 32px; height: 32px; border-radius: 50%; }
  .avatar-preview { text-align:center; margin-top:15px; }
  .avatar-preview img { width: 80px; height: 80px; border-radius: 50%; }
</style>
</head>
<body>
<div class="menu" id="menuBox">
  <h2>ReyStore</h2>
  <button onclick="bukaForm()">Beli Robux</button>
  <button onclick="window.location.href='invoice.html'">Cek Pesanan</button>
  <button onclick="window.location.href='https://support.reyambon.xyz'">Customer Service</button>
</div>

<div class="form-box" id="formBox" style="display:none;">
  <h2>Beli Robux</h2>

  <label>Username Roblox</label>
  <div style="position:relative;">
    <input type="text" id="username" placeholder="Ketik username Roblox...">
    <div id="searchResults"></div>
  </div>

  <div class="avatar-preview" id="avatarPreview"></div>

  <label>Jumlah Robux</label>
  <input type="number" id="jumlah" placeholder="Contoh: 80">

  <button onclick="lanjut()">Lanjut</button>
  <button onclick="kembali()">Kembali</button>
</div>

<script>
let selectedUser = null;

function bukaForm(){
  document.getElementById('menuBox').style.display = 'none';
  document.getElementById('formBox').style.display = 'block';
}
function kembali(){
  document.getElementById('formBox').style.display = 'none';
  document.getElementById('menuBox').style.display = 'block';
}

document.getElementById('username').addEventListener('input', async function() {
  const keyword = this.value.trim();
  const resultsDiv = document.getElementById('searchResults');
  resultsDiv.innerHTML = '';
  document.getElementById('avatarPreview').innerHTML = '';
  selectedUser = null;

  if (keyword.length < 3) {
    resultsDiv.style.display = 'none';
    return;
  }

  const url = `https://users.roblox.com/v1/usernames/search?keyword=${encodeURIComponent(keyword)}&limit=5`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    if (!data.data || data.data.length === 0) {
      resultsDiv.style.display = 'none';
      return;
    }

    resultsDiv.style.display = 'block';
    data.data.forEach(user => {
      const div = document.createElement('div');
      div.className = 'result-item';
      const avatarUrl = `https://www.roblox.com/headshot-thumbnail/image?userId=${user.id}&width=48&height=48&format=png`;
      div.innerHTML = `<img src="${avatarUrl}"><span>${user.name}</span>`;
      div.onclick = () => pilihUser(user);
      resultsDiv.appendChild(div);
    });
  } catch (err) {
    console.error(err);
  }
});

function pilihUser(user) {
  document.getElementById('username').value = user.name;
  document.getElementById('searchResults').style.display = 'none';
  selectedUser = user;

  const avatarUrl = `https://www.roblox.com/headshot-thumbnail/image?userId=${user.id}&width=100&height=100&format=png`;
  document.getElementById('avatarPreview').innerHTML = `
    <p>Apakah ini akunmu?</p>
    <img src="${avatarUrl}" alt="avatar"><p>${user.displayName} (${user.name})</p>`;
}

function lanjut() {
  if (!selectedUser) {
    alert('Pilih akun Roblox dulu dari daftar!');
    return;
  }
  const jumlah = parseInt(document.getElementById('jumlah').value);
  if (!jumlah || jumlah <= 0) {
    alert('Masukkan jumlah Robux.');
    return;
  }

  // Disini bisa lanjut ke WA, atau simpan ke database
  alert(`Akun: ${selectedUser.name} (ID: ${selectedUser.id})\nJumlah: ${jumlah}`);
}
</script>
</body>
</html>
